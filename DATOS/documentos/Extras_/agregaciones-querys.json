/*----------AIRE----------*/
db.aire.aggregate(
   [
      {
        $group : {
           _id : "$Provincia",
           count: { $sum: 1 }
        }
      },
	  { $sort : { count : -1 } }
   ]
);

db.aire.aggregate(
   [
      {
        $group : {
           _id : "$Ciudad",
           count: { $sum: 1 }
        }
      },
	  { $sort : { count : -1 } }
   ]
);

/*Ejemplo de calculo de medias de etaciones para una provincia*/
db.aire.aggregate([
	{"$match":{"Provincia":"MADRID"}},
	{"$unwind":"$Medidas"},
	{"$group":
		{"_id":"$Estacion",
		"average_NO2":{"$avg":"$Medidas.NO2"},
		"average_CO2":{"$avg":"$Medidas.CO2"},
		"average_BEN":{"$avg":"$Medidas.BEN"}
		/*continuar*/
		}	
	}
]);

/*Ejemplo de calculo de medias para una provincia por mes*/
db.aire.aggregate([
	{"$match":{"Provincia":"MADRID"}},
	{"$unwind":"$Medidas"},
	{"$group":
		{"_id":{
			"month":{"$month":"$Medidas.Fecha"},
			"year":{"$year":"$Medidas.Fecha"},
		},
		"average_NO2":{"$avg":"$Medidas.NO2"},
		/*continuar*/
		}	
	},
	{"$sort":{"_id.year":1,"_id.month":1}}
]);

/*----------TWITTER----------*/
db.twitter.find({$and:[{place:{$ne:null}},{place:{$exists:true}}]}).pretty();

db.twitter.remove({$and:[{'lang':{$ne:'es'}},{'lang':{$ne:'und'}},{'lang':{$exists:true}}]});

db.twitter.update({$and:[{'place':null},{'place':{$exists:true}}]},{$unset:{'place':''}},{multi:true});

db.twitter.remove({'contenido':{'$regex':'^RT '}});

/*PARA LIMPIAR TWEETS AGRUPAR POR 'CONTENIDO? y borrar los repetidos salvo los q tengan loc, place o geo*/

db.twitter.remove({$and:[{'place.pais':{'$ne':'Espa√±a'}},{place:{$exists:'true'}}]});

/*----------CARTODB----------*/
db.cartodb.insert({
	"_id":"BARCELONA",
	"Mapas":{
		"NO2":"<iframe width='100%' height='520' frameborder='0' src='https://100290698.cartodb.com/viz/d2bdf8da-9565-11e5-be60-0ef24382571b/embed_map' allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>"
	}
});
